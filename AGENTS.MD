# AGENTS.MD — Контекст и регламент для Codex по проекту Slipknot Shop

## Кратко о проекте
Интернет‑магазин мерча (тематика Slipknot) с ролями Admin/Manager/User, каталогом, карточкой товара,
корзиной, оформлением заказа, историей заказов и размер‑зависимым ценообразованием.

## Репозиторий и ветки
- Репозиторий: см. текущий чат (GitHub: amarockstarpopstar/slipknot-shop).
- Основная работа ведётся в ветке `develop`. Для задач создавай фиче‑ветки от `develop` с префиксом `codex/`,
  например: `codex/fix-checkout-errors`.
- В репозитории есть папки `frontend/`, `backend/`, и служебные материалы в `Tasks/`.
- Если встречается docker‑compose — не использовать для локалки; приоритет у локального PostgreSQL.

## Где лежит контекст
- Этот файл: `AGENTS.MD` (корень).
- Детали по фронту: `doc_frontend.txt` (лежит рядом с AGENTS.MD; см. вложение к задаче).
- Детали по бэку: `doc_backend.txt` (лежит рядом с AGENTS.MD; см. вложение к задаче).

## Среда разработки
1) Node.js LTS ≥ 20. Пакетный менеджер определить по lock‑файлам в папках `frontend/` и `backend/`.
2) Локальный PostgreSQL 16+ (без Docker). Создать пользователя/БД и прописать `.env` в `backend/`.
3) Разрешить CORS для порта фронтенда (обычно 5173).

## Быстрый старт (локально)
```bash
# фронтенд
cd frontend
<PM> install
<PM> run dev

# бэкенд
cd ../backend
<PM> install
# заполнить .env (DATABASE_URL/JWT_SECRET/PORT и т.д.)
<PM> run start:dev
```
После запуска бэкенда открыть фронтенд (dev‑сервер) и проверить авторизацию/каталог/корзину/оформление.

## Доменные правила (важно помнить)
- Цена товара зависит от выбранного размера.
- При добавлении в корзину фиксируем price_snapshot.
- Роли: Admin (полный доступ), Manager (управление товарами/заказами), User (покупки).
- UI: тёмный сплошной градиент по всей высоте страницы, модалки центрируются единым способом,
  мобильная адаптация обязательна.

## Check‑list перед каждым PR
- [ ] Все установки/сборки успешно выполняются (frontend+backend).
- [ ] .env настроен, БД доступна; нет ECONNREFUSED:5432.
- [ ] Роутинг проверен, защищённые маршруты работают.
- [ ] Размер‑зависимое ценообразование корректно на фронте и в БД/эндпоинтах.
- [ ] Линтеры/тесты пройдены (если есть).
- [ ] Скриншоты основных экранов приложены к PR либо сохранены в `Tasks/`.

## Коммиты и ПРы
- Именование: Conventional Commits (`feat: ...`, `fix: ...`, `chore: ...`, `docs: ...`).
- Один ПР — одна логическая задача. В описании перечисли изменения и приложи скриншоты.
- Ветка — из `develop`, мердж — обратно в `develop` через PR.

## Типовые задачи для Codex
1) **Модалки и градиент**: унифицировать центрирование, покрытие фоном всей высоты, мобильная адаптация; сделать скриншоты (desktop+mobile).
2) **Роутинг профиля**: проверить переходы «Перейти в профиль» и все защищённые маршруты.
3) **Размер‑цены**: добавить/исправить логику размера → цена (и на фронте, и на бэке), обновить схемы БД при необходимости.
4) **Локальный PostgreSQL**: убедиться, что подключение работает без Docker; при необходимости удалить docker‑compose и обновить конфиги/скрипты.
5) **Тест‑пользователи**: добавить заготовки для всех ролей для быстрой проверки.

## Что НЕ делать
- Не завязывать локальную разработку на Docker.
- Не хардкодить секреты в коде — только через `.env`.
- Не ломать существующий API без миграционного плана и совместимости на фронте.
